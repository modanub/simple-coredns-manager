{{define "corefile"}}
{{template "base" .}}
{{end}}

{{define "content"}}
{{$d := .Data}}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0"><i class="bi bi-file-earmark-code"></i> Corefile Editor</h4>
</div>

<form id="corefile-form">
    <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
    <div class="mb-3">
        <textarea class="form-control editor-textarea" name="content" rows="20" spellcheck="false">{{$d.Content}}</textarea>
    </div>

    <div class="d-flex gap-2 mb-3">
        <button type="button" class="btn btn-outline-info"
            hx-post="/corefile/preview"
            hx-include="[name='content'],[name='_csrf']"
            hx-target="#preview-area"
            hx-swap="innerHTML">
            <i class="bi bi-eye"></i> Preview Changes
        </button>
        <button type="button" class="btn btn-primary" onclick="saveCorefile(false)">
            <i class="bi bi-floppy"></i> Save
        </button>
        <button type="button" class="btn btn-success" onclick="saveCorefile(true)">
            <i class="bi bi-floppy"></i> Save &amp; Reload
        </button>
    </div>
</form>

<div id="preview-area" class="mb-3"></div>

<form id="save-form" method="POST" action="/corefile/save" style="display:none;">
    <input type="hidden" name="_csrf" value="{{.CSRFToken}}">
    <input type="hidden" name="content" id="save-content">
    <input type="hidden" name="reload" id="save-reload">
</form>

<script>
function saveCorefile(reload) {
    var content = document.querySelector('#corefile-form textarea[name="content"]').value;
    document.getElementById('save-content').value = content;
    document.getElementById('save-reload').value = reload ? 'true' : 'false';
    document.getElementById('save-form').submit();
}
</script>
{{end}}
